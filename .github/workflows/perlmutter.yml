name: Perlmutter
on:
  push:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:

    - name: checkout omega_h
      uses: actions/checkout@v4
      with:
        path: omega_h

    - name: setup python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'
    
    - name: install packing
      run: sudo apt install python3-packaging

    - name: install globus
      run: |
          python -m ensurepip --upgrade --user
          python -m pip install globus-compute-endpoint

    - name: use globus
      env:
        GLOBUS_ID: ${{ secrets.GLOBUS_COMPUTE_ID }}
        GLOBUS_SECRET: ${{ secrets.GLOBUS_COMPUTE_SECRET }}
      run: |
        export FUNCX_SDK_CLIENT_ID="$GLOBUS_ID"
        export FUNCX_SDK_CLIENT_ID="$GLOBUS_SECRET"
        python globusTests.py

    - name: print test summary
      run: cat omega_h-test-result/TestSummary.log

    - name: print test log
      run: cat omega_h-test-result/LastTest.log

    